<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–õ–µ–Ω—Ç–∞ | Chel-Love</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --bg: #0f172a; --text: #ffffff; --card: rgba(255, 255, 255, 0.05); --border: rgba(255, 255, 255, 0.1); }
        body.light-mode { --bg: #f1f5f9; --text: #0f172a; --card: #ffffff; --border: rgba(0,0,0,0.1); }
        body { background: var(--bg); color: var(--text); transition: 0.3s; padding-bottom: 100px; font-family: sans-serif; }
        .glass { background: var(--card); backdrop-filter: blur(10px); border: 1px solid var(--border); }
        .fab { background: #2563eb; box-shadow: 0 10px 25px rgba(37, 99, 235, 0.4); }
    </style>
</head>
<body class="overflow-x-hidden">
    <header class="p-4 flex justify-between items-center glass sticky top-0 z-50">
        <a href="index.html" class="text-sm font-bold opacity-70">‚Üê –ù–ê–ó–ê–î</a>
        <div class="text-blue-500 font-black text-lg">CHEL<span class="text-white ml-1 font-light opacity-50">LIVE</span></div>
        <button onclick="toggleTheme()" class="p-2 rounded-full glass" id="themeBtn">üåô</button>
    </header>

    <main id="feed" class="max-w-xl mx-auto p-4 space-y-6 mt-4"></main>

    <button onclick="openModal()" class="fixed bottom-6 left-1/2 -translate-x-1/2 fab text-white px-8 py-4 rounded-2xl font-bold z-40 flex items-center gap-2 active:scale-95 transition">
        <span>üìù</span> –ú–û–Ø –ê–ù–ö–ï–¢–ê
    </button>

    <div id="m" class="hidden fixed inset-0 bg-black/95 z-[100] flex items-center justify-center p-4">
        <div class="bg-slate-900 p-6 md:p-8 rounded-[2.5rem] w-full max-w-sm border border-white/10">
            <h2 class="text-xl font-bold mb-6 text-blue-400">–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–Ω–∫–µ—Ç—ã</h2>
            <div class="space-y-3">
                <input type="text" id="postName" placeholder="–ò–º—è" class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10 text-white text-sm">
                <input type="number" id="age" placeholder="–í–æ–∑—Ä–∞—Å—Ç" class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10 text-white text-sm">
                <input type="text" id="photo" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ —Ñ–æ—Ç–æ (URL)" class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10 text-white text-sm">
                <input type="text" id="tg" placeholder="Telegram (–±–µ–∑ @)" class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10 text-white text-sm">
                <textarea id="bio" placeholder="–û —Å–µ–±–µ..." class="w-full bg-white/5 p-4 rounded-2xl outline-none border border-white/10 text-white h-24 text-sm"></textarea>
            </div>
            <button id="sendBtn" class="w-full fab text-white py-4 rounded-2xl font-bold mt-6">–°–û–•–†–ê–ù–ò–¢–¨</button>
            <button onclick="document.getElementById('m').classList.add('hidden')" class="w-full mt-4 text-gray-500 text-sm">–û–¢–ú–ï–ù–ê</button>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { getDatabase, ref, set, get, onValue } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCTIwDY2Kjzeo5c3X7gyy89mOhHs0RlJyw",
            authDomain: "chel-love.firebaseapp.com",
            databaseURL: "https://chel-love-default-rtdb.firebaseio.com",
            projectId: "chel-love",
            appId: "1:334954303228:web:1d523948b0d3b0e8f25179"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        window.toggleTheme = () => {
            const isLight = document.body.classList.toggle('light-mode');
            localStorage.setItem('theme', isLight ? 'light' : 'dark');
            document.getElementById('themeBtn').innerText = isLight ? '‚òÄÔ∏è' : 'üåô';
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Å–µ–π –ª–µ–Ω—Ç—ã
        const feed = document.getElementById('feed');
        onValue(ref(db, 'posts'), (snapshot) => {
            const data = snapshot.val();
            if (!data) return feed.innerHTML = "<div class='text-center opacity-30 mt-10'>–ó–¥–µ—Å—å –ø–æ–∫–∞ –Ω–∏–∫–æ–≥–æ –Ω–µ—Ç...</div>";
            
            const posts = Object.values(data).reverse();
            feed.innerHTML = posts.map(p => `
                <div class="glass rounded-[2rem] overflow-hidden shadow-xl animate__animated animate__fadeInUp">
                    <img src="${p.photo || 'https://via.placeholder.com/500'}" class="w-full h-[450px] object-cover" onerror="this.src='https://via.placeholder.com/500?text=–ù–µ—Ç+—Ñ–æ—Ç–æ'">
                    <div class="p-6">
                        <div class="flex justify-between items-center">
                            <h3 class="text-2xl font-bold">${p.name}, ${p.age}</h3>
                            <span class="text-[10px] bg-blue-500/20 text-blue-400 px-2 py-1 rounded-md uppercase font-bold tracking-widest">–ß–µ–ª—è–±–∏–Ω—Å–∫</span>
                        </div>
                        <p class="text-gray-400 my-4 text-sm leading-relaxed">${p.text}</p>
                        <a href="https://t.me/${p.contact}" target="_blank" class="block w-full fab text-white py-4 rounded-2xl font-bold text-center active:opacity-80">‚úàÔ∏è –ù–ê–ü–ò–°–ê–¢–¨</a>
                    </div>
                </div>
            `).join('');
        });

        // –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª–∫–∏ —Å –ø—Ä–µ–¥–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö
        window.openModal = async () => {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            if(!user) return alert("–í–æ–π–¥–∏ –≤ –∞–∫–∫–∞—É–Ω—Ç!");
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∞–Ω–∫–µ—Ç–∞ —É —é–∑–µ—Ä–∞, —á—Ç–æ–±—ã –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ
            const postRef = ref(db, 'posts/' + user.user);
            const snap = await get(postRef);
            if(snap.exists()) {
                const p = snap.val();
                document.getElementById('postName').value = p.name;
                document.getElementById('age').value = p.age;
                document.getElementById('photo').value = p.photo;
                document.getElementById('tg').value = p.contact;
                document.getElementById('bio').value = p.text;
            }
            document.getElementById('m').classList.remove('hidden');
        };

        document.getElementById('sendBtn').onclick = async () => {
            const user = JSON.parse(localStorage.getItem('currentUser'));
            const name = document.getElementById('postName').value.trim();
            const age = document.getElementById('age').value;
            const photo = document.getElementById('photo').value.trim();
            const contact = document.getElementById('tg').value.trim().replace('@', '');
            const text = document.getElementById('bio').value.trim();

            if(!name || !age || !contact) return alert("–ó–∞–ø–æ–ª–Ω–∏ –∏–º—è, –≤–æ–∑—Ä–∞—Å—Ç –∏ —Ç–µ–ª–µ–≥—Ä–∞–º!");

            // –°–û–•–†–ê–ù–Ø–ï–ú –ü–û–î –ö–õ–Æ–ß–û–ú –õ–û–ì–ò–ù–ê (–û–î–ò–ù –Æ–ó–ï–† = –û–î–ù–ê –ê–ù–ö–ï–¢–ê)
            await set(ref(db, 'posts/' + user.user), { name, age, photo, contact, text, owner: user.user });
            document.getElementById('m').classList.add('hidden');
        };

        if (localStorage.getItem('theme') === 'light') {
            document.body.classList.add('light-mode');
            document.getElementById('themeBtn').innerText = '‚òÄÔ∏è';
        }
    </script>
</body>
</html>
